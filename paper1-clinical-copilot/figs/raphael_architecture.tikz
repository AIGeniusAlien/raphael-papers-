\begin{tikzpicture}[font=\small, node distance=8mm]
\node[draw,rounded corners,fill=gray!10,align=center] (ui) {Clinician UI\\(chat/voice/image)};
\node[draw,rounded corners,fill=gray!10,right=2.6cm of ui,align=center] (router) {LLM Router\\policy+PHI mode};
\node[draw,rounded corners,fill=blue!10,below=10mm of router,align=center] (gp) {Dialog LLM\\(general)};
\node[draw,rounded corners,fill=green!10,above=10mm of router,align=center] (med) {Medical Pipeline\\RAG + guardrails};

\node[draw,rounded corners,fill=yellow!15,right=3.1cm of med,align=center] (rag) {Guideline Index\\(AHA/ACC, ADA, CDC, WHO)};
\node[draw,rounded corners,fill=red!10,below=8mm of rag,align=center] (safety) {Safety Gates\\dose \& DDI \& abstain};
\node[draw,rounded corners,fill=orange!15,right=3.1cm of router,align=center] (ehr) {SMART-on-FHIR\\CRUD + Provenance};
\node[draw,rounded corners,fill=purple!10,below=10mm of gp,align=center] (audit) {Audit \& Metrics};

\draw[->] (ui) -- (router);
\draw[->] (router) -- (med);
\draw[->] (router) -- (gp);
\draw[->] (med) -- (rag);
\draw[->] (med) -- (safety);
\draw[->] (router) -- (ehr);
\draw[->] (gp) -- (audit);
\draw[->] (med) -- (audit);
\draw[->] (ehr) -- (audit);
\draw[->] (rag) |- (med);
\draw[->] (safety) |- (med);
\draw[->] (router) -- ++(0,2) -| (ui);
\end{tikzpicture}
